# Usar outra library
library(rgee)
ee_Initialize()
ee_install()
# Usar outra library
library(rgee)
ee_Initialize()
ee_Initialize()
# Usar outra library
library(rgee)
ee_Initialize()
# Usar outra library
library(rgee)
library(rgee)
library(googledrive)
library(sf)
library(tidyverse)
library(ggplot2)
rgee::ee_Initialize()
nc <- st_read("Cont_AAD_CAOP2020", geometry_column = "geometry") %>%
subset(Concelho %in% c("Peniche"))
temps_ar <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2017-01-02", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only precipitation bands
ee$ImageCollection$toBands() # from imagecollection to image
peniche <- ee$FeatureCollection("FAO/GAUL/2015/level2") %>%
ee$FeatureCollection$select("ADM1_NAME", "ADM1_CODE", "Shape_Area", "Shape_Length")$filter("ADM1_NAME"="Leiria") %>%
ee$FeatureCollection$getInfo()
peniche <- ee$FeatureCollection("FAO/GAUL/2015/level2") %>%
ee$FeatureCollection$select("ADM1_NAME", "ADM1_CODE", "Shape_Area", "Shape_Length")$filter("ADM1_NAME"="Leiria") %>%
ee$FeatureCollection$getInfo()
ee_nc_temp <- ee_extract(
x = temps_ar,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
ee_nc_temp <- ee_nc_temp %>%
pivot_longer(X20170102_mean_2m_air_temperature:X20200709_mean_2m_air_temperature, names_to = "day", values_to = "K") %>%
mutate(day, day=gsub("X", "", day)) %>%
mutate(day, day=gsub("_mean_2m_air_temperature", "", day))
ee_nc_temp %>%
ggplot(aes(x = day, y = K, color = K)) +
geom_line(alpha = 0.4) +
xlab("Day") +
ylab("Temperature (K)") +
theme_minimal()
View(ee_nc_temp)
temp_date <- subset(ee_nc_temp, day,K)
temp_date <- select(ee_nc_temp, c(day,K))
View(temp_date)
temp_date <- select(ee_nc_temp, -geometry)
?select
?subset
temp_date <- subset(ee_nc_temp, -geometry)
temp_date <- subset(ee_nc_temp, -geometry)
temp_date <- subset(ee_nc_temp, select=  -geometry)
View(temp_date)
temp_date <- subset(ee_nc_temp, select= day:K)
class(temp_date)
temp_date <- ee_nc_temp %>%
st_drop_geometry()
View(temp_date)
temps_ar_2 <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2020-07-10", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
ee_nc_temp <- ee_extract(
x = temps_ar_2,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
View(ee_nc_temp)
temps_ar_1 <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2017-01-02", "2020-07-09") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
temps_ar_2 <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2020-07-10", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands()
ee_nc_temp_1 <- ee_extract(
x = temps_ar_1,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
ee_nc_temp_2 <- ee_extract(
x = temps_ar_2,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
temps_ar_2 <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2020-07-10", "2021-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
ee_nc_temp_2 <- ee_extract(
x = temps_ar_2,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
temps_ar <- ee$ImageCollection("ECMWF/ERA5_LAND/DAILY_RAW") %>%
ee$ImageCollection$filterDate("2017-01-02", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("temperature_2m")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
ee_nc_temp <- ee_extract(
x = temps_ar,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
View(ee_nc_temp)
temps_ar <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2017-01-02", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
ee_nc_temp <- ee_extract(
x = temps_ar,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
temps_ar <- ee$ImageCollection("ECMWF/ERA5/DAILY") %>%
ee$ImageCollection$filterDate("2017-01-02", "2022-02-01") %>%
ee$ImageCollection$map(function(x) x$select("mean_2m_air_temperature")) %>% # Select only temperature bands
ee$ImageCollection$toBands() # from imagecollection to image
ee_nc_temp <- ee_extract(
x = temps_ar,
y = nc["geometry"], #Isto tem de ser alterado depois para o que quero mesmo
scale = 250,
fun = ee$Reducer$mean(),
sf = TRUE
)
# Ficamos com df com colunas Xyyyymmdd_mean_2m_air_temperature -> portanto colunas desde dia 2/1/2017 a 1/2/2022
# Which means, preciso de pegar no pivot_longer e por isto como deve ser, em que as rows sao datas
ee_nc_temp <- ee_nc_temp %>%
pivot_longer(X20170102_mean_2m_air_temperature:X20200709_mean_2m_air_temperature, names_to = "day", values_to = "K") %>%
mutate(day, day=gsub("X", "", day)) %>%
mutate(day, day=gsub("_mean_2m_air_temperature", "", day))
ee_nc_temp %>%
ggplot(aes(x = day, y = K, color = K)) +
geom_line(alpha = 0.4) +
xlab("Day") +
ylab("Temperature (K)") +
theme_minimal()
temp_date <- ee_nc_temp %>%
st_drop_geometry()
rm(temps_ar_2)
rm(temps_ar_1)
rm(ee_nc_temp_1)
temp_date <- ee_nc_temp %>%
st_drop_geometry() %>%
as.Date(day)
?as.Date
